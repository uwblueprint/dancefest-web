{"ast":null,"code":"import { getCommonParent, getTabbableNodes, getAllTabbableNodes, parentAutofocusables } from './utils/DOMutils';\nimport pickFirstFocus, { pickFocusable } from './utils/firstFocus';\nimport getAllAffectedNodes from './utils/all-affected';\nimport { asArray } from './utils/array';\n\nvar findAutoFocused = function findAutoFocused(autoFocusables) {\n  return function (node) {\n    return !!node.autofocus || node.dataset && !!node.dataset.autofocus || autoFocusables.indexOf(node) >= 0;\n  };\n};\n\nvar isGuard = function isGuard(node) {\n  return node && node.dataset && node.dataset.focusGuard;\n};\n\nvar notAGuard = function notAGuard(node) {\n  return !isGuard(node);\n};\n\nexport var newFocus = function newFocus(innerNodes, outerNodes, activeElement, lastNode, autoFocused) {\n  var cnt = innerNodes.length;\n  var firstFocus = innerNodes[0];\n  var lastFocus = innerNodes[cnt - 1];\n  var isOnGuard = isGuard(activeElement); // focus is inside\n\n  if (innerNodes.indexOf(activeElement) >= 0) {\n    return undefined;\n  }\n\n  var activeIndex = outerNodes.indexOf(activeElement);\n  var lastIndex = outerNodes.indexOf(lastNode || activeIndex);\n  var lastNodeInside = innerNodes.indexOf(lastNode);\n  var indexDiff = activeIndex - lastIndex;\n  var firstNodeIndex = outerNodes.indexOf(firstFocus);\n  var lastNodeIndex = outerNodes.indexOf(lastFocus);\n  var returnFirstNode = pickFocusable(innerNodes, 0);\n  var returnLastNode = pickFocusable(innerNodes, cnt - 1); // new focus\n\n  if (activeIndex === -1 || lastNodeInside === -1) {\n    return innerNodes.indexOf(autoFocused && autoFocused.length ? pickFirstFocus(autoFocused) : pickFirstFocus(innerNodes));\n  } // old focus\n\n\n  if (!indexDiff && lastNodeInside >= 0) {\n    return lastNodeInside;\n  } // first element\n\n\n  if (activeIndex <= firstNodeIndex && isOnGuard && Math.abs(indexDiff) > 1) {\n    return returnLastNode;\n  } // last element\n\n\n  if (activeIndex >= firstNodeIndex && isOnGuard && Math.abs(indexDiff) > 1) {\n    return returnFirstNode;\n  } // jump out, but not on the guard\n\n\n  if (indexDiff && Math.abs(indexDiff) > 1) {\n    return lastNodeInside;\n  } // focus above lock\n\n\n  if (activeIndex <= firstNodeIndex) {\n    return returnLastNode;\n  } // focus below lock\n\n\n  if (activeIndex > lastNodeIndex) {\n    return returnFirstNode;\n  } // index is inside tab order, but outside Lock\n\n\n  if (indexDiff) {\n    if (Math.abs(indexDiff) > 1) {\n      return lastNodeInside;\n    }\n\n    return (cnt + lastNodeInside + indexDiff) % cnt;\n  } // do nothing\n\n\n  return undefined;\n};\n\nvar getTopCommonParent = function getTopCommonParent(baseActiveElement, leftEntry, rightEntries) {\n  var activeElements = asArray(baseActiveElement);\n  var leftEntries = asArray(leftEntry);\n  var activeElement = activeElements[0];\n  var topCommon = null;\n  leftEntries.filter(Boolean).forEach(function (entry) {\n    topCommon = getCommonParent(topCommon || entry, entry) || topCommon;\n    rightEntries.filter(Boolean).forEach(function (subEntry) {\n      var common = getCommonParent(activeElement, subEntry);\n\n      if (common) {\n        if (!topCommon || common.contains(topCommon)) {\n          topCommon = common;\n        } else {\n          topCommon = getCommonParent(common, topCommon);\n        }\n      }\n    });\n  });\n  return topCommon;\n};\n\nvar allParentAutofocusables = function allParentAutofocusables(entries) {\n  return entries.reduce(function (acc, node) {\n    return acc.concat(parentAutofocusables(node));\n  }, []);\n};\n\nvar reorderNodes = function reorderNodes(srcNodes, dstNodes) {\n  var remap = new Map(); // no Set(dstNodes) for IE11 :(\n\n  dstNodes.forEach(function (entity) {\n    return remap.set(entity.node, entity);\n  }); // remap to dstNodes\n\n  return srcNodes.map(function (node) {\n    return remap.get(node);\n  }).filter(Boolean);\n};\n\nexport var getFocusabledIn = function getFocusabledIn(topNode) {\n  var entries = getAllAffectedNodes(topNode).filter(notAGuard);\n  var commonParent = getTopCommonParent(topNode, topNode, entries);\n  var outerNodes = getTabbableNodes([commonParent], true);\n  var innerElements = getTabbableNodes(entries).filter(function (_ref) {\n    var node = _ref.node;\n    return notAGuard(node);\n  }).map(function (_ref2) {\n    var node = _ref2.node;\n    return node;\n  });\n  return outerNodes.map(function (_ref3) {\n    var node = _ref3.node,\n        index = _ref3.index;\n    return {\n      node: node,\n      index: index,\n      lockItem: innerElements.indexOf(node) >= 0,\n      guard: isGuard(node)\n    };\n  });\n};\n\nvar getFocusMerge = function getFocusMerge(topNode, lastNode) {\n  var activeElement = document && document.activeElement;\n  var entries = getAllAffectedNodes(topNode).filter(notAGuard);\n  var commonParent = getTopCommonParent(activeElement || topNode, topNode, entries);\n  var innerElements = getTabbableNodes(entries).filter(function (_ref4) {\n    var node = _ref4.node;\n    return notAGuard(node);\n  });\n\n  if (!innerElements[0]) {\n    innerElements = getAllTabbableNodes(entries).filter(function (_ref5) {\n      var node = _ref5.node;\n      return notAGuard(node);\n    });\n\n    if (!innerElements[0]) {\n      return undefined;\n    }\n  }\n\n  var outerNodes = getTabbableNodes([commonParent]).map(function (_ref6) {\n    var node = _ref6.node;\n    return node;\n  });\n  var orderedInnerElements = reorderNodes(outerNodes, innerElements);\n  var innerNodes = orderedInnerElements.map(function (_ref7) {\n    var node = _ref7.node;\n    return node;\n  });\n  var newId = newFocus(innerNodes, outerNodes, activeElement, lastNode, innerNodes.filter(findAutoFocused(allParentAutofocusables(entries))));\n\n  if (newId === undefined) {\n    return newId;\n  }\n\n  return orderedInnerElements[newId];\n};\n\nexport default getFocusMerge;","map":{"version":3,"sources":["/Users/oustan/Documents/PROJECTS/dancefest-web/frontend/node_modules/focus-lock/dist/es2015/focusMerge.js"],"names":["getCommonParent","getTabbableNodes","getAllTabbableNodes","parentAutofocusables","pickFirstFocus","pickFocusable","getAllAffectedNodes","asArray","findAutoFocused","autoFocusables","node","autofocus","dataset","indexOf","isGuard","focusGuard","notAGuard","newFocus","innerNodes","outerNodes","activeElement","lastNode","autoFocused","cnt","length","firstFocus","lastFocus","isOnGuard","undefined","activeIndex","lastIndex","lastNodeInside","indexDiff","firstNodeIndex","lastNodeIndex","returnFirstNode","returnLastNode","Math","abs","getTopCommonParent","baseActiveElement","leftEntry","rightEntries","activeElements","leftEntries","topCommon","filter","Boolean","forEach","entry","subEntry","common","contains","allParentAutofocusables","entries","reduce","acc","concat","reorderNodes","srcNodes","dstNodes","remap","Map","entity","set","map","get","getFocusabledIn","topNode","commonParent","innerElements","_ref","_ref2","_ref3","index","lockItem","guard","getFocusMerge","document","_ref4","_ref5","_ref6","orderedInnerElements","_ref7","newId"],"mappings":"AAAA,SAASA,eAAT,EAA0BC,gBAA1B,EAA4CC,mBAA5C,EAAiEC,oBAAjE,QAA6F,kBAA7F;AACA,OAAOC,cAAP,IAAyBC,aAAzB,QAA8C,oBAA9C;AACA,OAAOC,mBAAP,MAAgC,sBAAhC;AACA,SAASC,OAAT,QAAwB,eAAxB;;AAEA,IAAIC,eAAe,GAAG,SAASA,eAAT,CAAyBC,cAAzB,EAAyC;AAC7D,SAAO,UAAUC,IAAV,EAAgB;AACrB,WAAO,CAAC,CAACA,IAAI,CAACC,SAAP,IAAoBD,IAAI,CAACE,OAAL,IAAgB,CAAC,CAACF,IAAI,CAACE,OAAL,CAAaD,SAAnD,IAAgEF,cAAc,CAACI,OAAf,CAAuBH,IAAvB,KAAgC,CAAvG;AACD,GAFD;AAGD,CAJD;;AAMA,IAAII,OAAO,GAAG,SAASA,OAAT,CAAiBJ,IAAjB,EAAuB;AACnC,SAAOA,IAAI,IAAIA,IAAI,CAACE,OAAb,IAAwBF,IAAI,CAACE,OAAL,CAAaG,UAA5C;AACD,CAFD;;AAGA,IAAIC,SAAS,GAAG,SAASA,SAAT,CAAmBN,IAAnB,EAAyB;AACvC,SAAO,CAACI,OAAO,CAACJ,IAAD,CAAf;AACD,CAFD;;AAIA,OAAO,IAAIO,QAAQ,GAAG,SAASA,QAAT,CAAkBC,UAAlB,EAA8BC,UAA9B,EAA0CC,aAA1C,EAAyDC,QAAzD,EAAmEC,WAAnE,EAAgF;AACpG,MAAIC,GAAG,GAAGL,UAAU,CAACM,MAArB;AACA,MAAIC,UAAU,GAAGP,UAAU,CAAC,CAAD,CAA3B;AACA,MAAIQ,SAAS,GAAGR,UAAU,CAACK,GAAG,GAAG,CAAP,CAA1B;AACA,MAAII,SAAS,GAAGb,OAAO,CAACM,aAAD,CAAvB,CAJoG,CAMpG;;AACA,MAAIF,UAAU,CAACL,OAAX,CAAmBO,aAAnB,KAAqC,CAAzC,EAA4C;AAC1C,WAAOQ,SAAP;AACD;;AAED,MAAIC,WAAW,GAAGV,UAAU,CAACN,OAAX,CAAmBO,aAAnB,CAAlB;AACA,MAAIU,SAAS,GAAGX,UAAU,CAACN,OAAX,CAAmBQ,QAAQ,IAAIQ,WAA/B,CAAhB;AACA,MAAIE,cAAc,GAAGb,UAAU,CAACL,OAAX,CAAmBQ,QAAnB,CAArB;AACA,MAAIW,SAAS,GAAGH,WAAW,GAAGC,SAA9B;AACA,MAAIG,cAAc,GAAGd,UAAU,CAACN,OAAX,CAAmBY,UAAnB,CAArB;AACA,MAAIS,aAAa,GAAGf,UAAU,CAACN,OAAX,CAAmBa,SAAnB,CAApB;AAEA,MAAIS,eAAe,GAAG9B,aAAa,CAACa,UAAD,EAAa,CAAb,CAAnC;AACA,MAAIkB,cAAc,GAAG/B,aAAa,CAACa,UAAD,EAAaK,GAAG,GAAG,CAAnB,CAAlC,CAnBoG,CAqBpG;;AACA,MAAIM,WAAW,KAAK,CAAC,CAAjB,IAAsBE,cAAc,KAAK,CAAC,CAA9C,EAAiD;AAC/C,WAAOb,UAAU,CAACL,OAAX,CAAmBS,WAAW,IAAIA,WAAW,CAACE,MAA3B,GAAoCpB,cAAc,CAACkB,WAAD,CAAlD,GAAkElB,cAAc,CAACc,UAAD,CAAnG,CAAP;AACD,GAxBmG,CAyBpG;;;AACA,MAAI,CAACc,SAAD,IAAcD,cAAc,IAAI,CAApC,EAAuC;AACrC,WAAOA,cAAP;AACD,GA5BmG,CA6BpG;;;AACA,MAAIF,WAAW,IAAII,cAAf,IAAiCN,SAAjC,IAA8CU,IAAI,CAACC,GAAL,CAASN,SAAT,IAAsB,CAAxE,EAA2E;AACzE,WAAOI,cAAP;AACD,GAhCmG,CAiCpG;;;AACA,MAAIP,WAAW,IAAII,cAAf,IAAiCN,SAAjC,IAA8CU,IAAI,CAACC,GAAL,CAASN,SAAT,IAAsB,CAAxE,EAA2E;AACzE,WAAOG,eAAP;AACD,GApCmG,CAqCpG;;;AACA,MAAIH,SAAS,IAAIK,IAAI,CAACC,GAAL,CAASN,SAAT,IAAsB,CAAvC,EAA0C;AACxC,WAAOD,cAAP;AACD,GAxCmG,CAyCpG;;;AACA,MAAIF,WAAW,IAAII,cAAnB,EAAmC;AACjC,WAAOG,cAAP;AACD,GA5CmG,CA6CpG;;;AACA,MAAIP,WAAW,GAAGK,aAAlB,EAAiC;AAC/B,WAAOC,eAAP;AACD,GAhDmG,CAiDpG;;;AACA,MAAIH,SAAJ,EAAe;AACb,QAAIK,IAAI,CAACC,GAAL,CAASN,SAAT,IAAsB,CAA1B,EAA6B;AAC3B,aAAOD,cAAP;AACD;;AACD,WAAO,CAACR,GAAG,GAAGQ,cAAN,GAAuBC,SAAxB,IAAqCT,GAA5C;AACD,GAvDmG,CAwDpG;;;AACA,SAAOK,SAAP;AACD,CA1DM;;AA4DP,IAAIW,kBAAkB,GAAG,SAASA,kBAAT,CAA4BC,iBAA5B,EAA+CC,SAA/C,EAA0DC,YAA1D,EAAwE;AAC/F,MAAIC,cAAc,GAAGpC,OAAO,CAACiC,iBAAD,CAA5B;AACA,MAAII,WAAW,GAAGrC,OAAO,CAACkC,SAAD,CAAzB;AACA,MAAIrB,aAAa,GAAGuB,cAAc,CAAC,CAAD,CAAlC;AACA,MAAIE,SAAS,GAAG,IAAhB;AACAD,EAAAA,WAAW,CAACE,MAAZ,CAAmBC,OAAnB,EAA4BC,OAA5B,CAAoC,UAAUC,KAAV,EAAiB;AACnDJ,IAAAA,SAAS,GAAG7C,eAAe,CAAC6C,SAAS,IAAII,KAAd,EAAqBA,KAArB,CAAf,IAA8CJ,SAA1D;AACAH,IAAAA,YAAY,CAACI,MAAb,CAAoBC,OAApB,EAA6BC,OAA7B,CAAqC,UAAUE,QAAV,EAAoB;AACvD,UAAIC,MAAM,GAAGnD,eAAe,CAACoB,aAAD,EAAgB8B,QAAhB,CAA5B;;AACA,UAAIC,MAAJ,EAAY;AACV,YAAI,CAACN,SAAD,IAAcM,MAAM,CAACC,QAAP,CAAgBP,SAAhB,CAAlB,EAA8C;AAC5CA,UAAAA,SAAS,GAAGM,MAAZ;AACD,SAFD,MAEO;AACLN,UAAAA,SAAS,GAAG7C,eAAe,CAACmD,MAAD,EAASN,SAAT,CAA3B;AACD;AACF;AACF,KATD;AAUD,GAZD;AAaA,SAAOA,SAAP;AACD,CAnBD;;AAqBA,IAAIQ,uBAAuB,GAAG,SAASA,uBAAT,CAAiCC,OAAjC,EAA0C;AACtE,SAAOA,OAAO,CAACC,MAAR,CAAe,UAAUC,GAAV,EAAe9C,IAAf,EAAqB;AACzC,WAAO8C,GAAG,CAACC,MAAJ,CAAWtD,oBAAoB,CAACO,IAAD,CAA/B,CAAP;AACD,GAFM,EAEJ,EAFI,CAAP;AAGD,CAJD;;AAMA,IAAIgD,YAAY,GAAG,SAASA,YAAT,CAAsBC,QAAtB,EAAgCC,QAAhC,EAA0C;AAC3D,MAAIC,KAAK,GAAG,IAAIC,GAAJ,EAAZ,CAD2D,CAE3D;;AACAF,EAAAA,QAAQ,CAACZ,OAAT,CAAiB,UAAUe,MAAV,EAAkB;AACjC,WAAOF,KAAK,CAACG,GAAN,CAAUD,MAAM,CAACrD,IAAjB,EAAuBqD,MAAvB,CAAP;AACD,GAFD,EAH2D,CAM3D;;AACA,SAAOJ,QAAQ,CAACM,GAAT,CAAa,UAAUvD,IAAV,EAAgB;AAClC,WAAOmD,KAAK,CAACK,GAAN,CAAUxD,IAAV,CAAP;AACD,GAFM,EAEJoC,MAFI,CAEGC,OAFH,CAAP;AAGD,CAVD;;AAYA,OAAO,IAAIoB,eAAe,GAAG,SAASA,eAAT,CAAyBC,OAAzB,EAAkC;AAC7D,MAAId,OAAO,GAAGhD,mBAAmB,CAAC8D,OAAD,CAAnB,CAA6BtB,MAA7B,CAAoC9B,SAApC,CAAd;AACA,MAAIqD,YAAY,GAAG9B,kBAAkB,CAAC6B,OAAD,EAAUA,OAAV,EAAmBd,OAAnB,CAArC;AACA,MAAInC,UAAU,GAAGlB,gBAAgB,CAAC,CAACoE,YAAD,CAAD,EAAiB,IAAjB,CAAjC;AACA,MAAIC,aAAa,GAAGrE,gBAAgB,CAACqD,OAAD,CAAhB,CAA0BR,MAA1B,CAAiC,UAAUyB,IAAV,EAAgB;AACnE,QAAI7D,IAAI,GAAG6D,IAAI,CAAC7D,IAAhB;AACA,WAAOM,SAAS,CAACN,IAAD,CAAhB;AACD,GAHmB,EAGjBuD,GAHiB,CAGb,UAAUO,KAAV,EAAiB;AACtB,QAAI9D,IAAI,GAAG8D,KAAK,CAAC9D,IAAjB;AACA,WAAOA,IAAP;AACD,GANmB,CAApB;AAQA,SAAOS,UAAU,CAAC8C,GAAX,CAAe,UAAUQ,KAAV,EAAiB;AACrC,QAAI/D,IAAI,GAAG+D,KAAK,CAAC/D,IAAjB;AAAA,QACIgE,KAAK,GAAGD,KAAK,CAACC,KADlB;AAEA,WAAO;AACLhE,MAAAA,IAAI,EAAEA,IADD;AAELgE,MAAAA,KAAK,EAAEA,KAFF;AAGLC,MAAAA,QAAQ,EAAEL,aAAa,CAACzD,OAAd,CAAsBH,IAAtB,KAA+B,CAHpC;AAILkE,MAAAA,KAAK,EAAE9D,OAAO,CAACJ,IAAD;AAJT,KAAP;AAMD,GATM,CAAP;AAUD,CAtBM;;AAwBP,IAAImE,aAAa,GAAG,SAASA,aAAT,CAAuBT,OAAvB,EAAgC/C,QAAhC,EAA0C;AAC5D,MAAID,aAAa,GAAG0D,QAAQ,IAAIA,QAAQ,CAAC1D,aAAzC;AACA,MAAIkC,OAAO,GAAGhD,mBAAmB,CAAC8D,OAAD,CAAnB,CAA6BtB,MAA7B,CAAoC9B,SAApC,CAAd;AAEA,MAAIqD,YAAY,GAAG9B,kBAAkB,CAACnB,aAAa,IAAIgD,OAAlB,EAA2BA,OAA3B,EAAoCd,OAApC,CAArC;AAEA,MAAIgB,aAAa,GAAGrE,gBAAgB,CAACqD,OAAD,CAAhB,CAA0BR,MAA1B,CAAiC,UAAUiC,KAAV,EAAiB;AACpE,QAAIrE,IAAI,GAAGqE,KAAK,CAACrE,IAAjB;AACA,WAAOM,SAAS,CAACN,IAAD,CAAhB;AACD,GAHmB,CAApB;;AAKA,MAAI,CAAC4D,aAAa,CAAC,CAAD,CAAlB,EAAuB;AACrBA,IAAAA,aAAa,GAAGpE,mBAAmB,CAACoD,OAAD,CAAnB,CAA6BR,MAA7B,CAAoC,UAAUkC,KAAV,EAAiB;AACnE,UAAItE,IAAI,GAAGsE,KAAK,CAACtE,IAAjB;AACA,aAAOM,SAAS,CAACN,IAAD,CAAhB;AACD,KAHe,CAAhB;;AAIA,QAAI,CAAC4D,aAAa,CAAC,CAAD,CAAlB,EAAuB;AACrB,aAAO1C,SAAP;AACD;AACF;;AAED,MAAIT,UAAU,GAAGlB,gBAAgB,CAAC,CAACoE,YAAD,CAAD,CAAhB,CAAiCJ,GAAjC,CAAqC,UAAUgB,KAAV,EAAiB;AACrE,QAAIvE,IAAI,GAAGuE,KAAK,CAACvE,IAAjB;AACA,WAAOA,IAAP;AACD,GAHgB,CAAjB;AAIA,MAAIwE,oBAAoB,GAAGxB,YAAY,CAACvC,UAAD,EAAamD,aAAb,CAAvC;AACA,MAAIpD,UAAU,GAAGgE,oBAAoB,CAACjB,GAArB,CAAyB,UAAUkB,KAAV,EAAiB;AACzD,QAAIzE,IAAI,GAAGyE,KAAK,CAACzE,IAAjB;AACA,WAAOA,IAAP;AACD,GAHgB,CAAjB;AAKA,MAAI0E,KAAK,GAAGnE,QAAQ,CAACC,UAAD,EAAaC,UAAb,EAAyBC,aAAzB,EAAwCC,QAAxC,EAAkDH,UAAU,CAAC4B,MAAX,CAAkBtC,eAAe,CAAC6C,uBAAuB,CAACC,OAAD,CAAxB,CAAjC,CAAlD,CAApB;;AAEA,MAAI8B,KAAK,KAAKxD,SAAd,EAAyB;AACvB,WAAOwD,KAAP;AACD;;AACD,SAAOF,oBAAoB,CAACE,KAAD,CAA3B;AACD,CArCD;;AAuCA,eAAeP,aAAf","sourcesContent":["import { getCommonParent, getTabbableNodes, getAllTabbableNodes, parentAutofocusables } from './utils/DOMutils';\nimport pickFirstFocus, { pickFocusable } from './utils/firstFocus';\nimport getAllAffectedNodes from './utils/all-affected';\nimport { asArray } from './utils/array';\n\nvar findAutoFocused = function findAutoFocused(autoFocusables) {\n  return function (node) {\n    return !!node.autofocus || node.dataset && !!node.dataset.autofocus || autoFocusables.indexOf(node) >= 0;\n  };\n};\n\nvar isGuard = function isGuard(node) {\n  return node && node.dataset && node.dataset.focusGuard;\n};\nvar notAGuard = function notAGuard(node) {\n  return !isGuard(node);\n};\n\nexport var newFocus = function newFocus(innerNodes, outerNodes, activeElement, lastNode, autoFocused) {\n  var cnt = innerNodes.length;\n  var firstFocus = innerNodes[0];\n  var lastFocus = innerNodes[cnt - 1];\n  var isOnGuard = isGuard(activeElement);\n\n  // focus is inside\n  if (innerNodes.indexOf(activeElement) >= 0) {\n    return undefined;\n  }\n\n  var activeIndex = outerNodes.indexOf(activeElement);\n  var lastIndex = outerNodes.indexOf(lastNode || activeIndex);\n  var lastNodeInside = innerNodes.indexOf(lastNode);\n  var indexDiff = activeIndex - lastIndex;\n  var firstNodeIndex = outerNodes.indexOf(firstFocus);\n  var lastNodeIndex = outerNodes.indexOf(lastFocus);\n\n  var returnFirstNode = pickFocusable(innerNodes, 0);\n  var returnLastNode = pickFocusable(innerNodes, cnt - 1);\n\n  // new focus\n  if (activeIndex === -1 || lastNodeInside === -1) {\n    return innerNodes.indexOf(autoFocused && autoFocused.length ? pickFirstFocus(autoFocused) : pickFirstFocus(innerNodes));\n  }\n  // old focus\n  if (!indexDiff && lastNodeInside >= 0) {\n    return lastNodeInside;\n  }\n  // first element\n  if (activeIndex <= firstNodeIndex && isOnGuard && Math.abs(indexDiff) > 1) {\n    return returnLastNode;\n  }\n  // last element\n  if (activeIndex >= firstNodeIndex && isOnGuard && Math.abs(indexDiff) > 1) {\n    return returnFirstNode;\n  }\n  // jump out, but not on the guard\n  if (indexDiff && Math.abs(indexDiff) > 1) {\n    return lastNodeInside;\n  }\n  // focus above lock\n  if (activeIndex <= firstNodeIndex) {\n    return returnLastNode;\n  }\n  // focus below lock\n  if (activeIndex > lastNodeIndex) {\n    return returnFirstNode;\n  }\n  // index is inside tab order, but outside Lock\n  if (indexDiff) {\n    if (Math.abs(indexDiff) > 1) {\n      return lastNodeInside;\n    }\n    return (cnt + lastNodeInside + indexDiff) % cnt;\n  }\n  // do nothing\n  return undefined;\n};\n\nvar getTopCommonParent = function getTopCommonParent(baseActiveElement, leftEntry, rightEntries) {\n  var activeElements = asArray(baseActiveElement);\n  var leftEntries = asArray(leftEntry);\n  var activeElement = activeElements[0];\n  var topCommon = null;\n  leftEntries.filter(Boolean).forEach(function (entry) {\n    topCommon = getCommonParent(topCommon || entry, entry) || topCommon;\n    rightEntries.filter(Boolean).forEach(function (subEntry) {\n      var common = getCommonParent(activeElement, subEntry);\n      if (common) {\n        if (!topCommon || common.contains(topCommon)) {\n          topCommon = common;\n        } else {\n          topCommon = getCommonParent(common, topCommon);\n        }\n      }\n    });\n  });\n  return topCommon;\n};\n\nvar allParentAutofocusables = function allParentAutofocusables(entries) {\n  return entries.reduce(function (acc, node) {\n    return acc.concat(parentAutofocusables(node));\n  }, []);\n};\n\nvar reorderNodes = function reorderNodes(srcNodes, dstNodes) {\n  var remap = new Map();\n  // no Set(dstNodes) for IE11 :(\n  dstNodes.forEach(function (entity) {\n    return remap.set(entity.node, entity);\n  });\n  // remap to dstNodes\n  return srcNodes.map(function (node) {\n    return remap.get(node);\n  }).filter(Boolean);\n};\n\nexport var getFocusabledIn = function getFocusabledIn(topNode) {\n  var entries = getAllAffectedNodes(topNode).filter(notAGuard);\n  var commonParent = getTopCommonParent(topNode, topNode, entries);\n  var outerNodes = getTabbableNodes([commonParent], true);\n  var innerElements = getTabbableNodes(entries).filter(function (_ref) {\n    var node = _ref.node;\n    return notAGuard(node);\n  }).map(function (_ref2) {\n    var node = _ref2.node;\n    return node;\n  });\n\n  return outerNodes.map(function (_ref3) {\n    var node = _ref3.node,\n        index = _ref3.index;\n    return {\n      node: node,\n      index: index,\n      lockItem: innerElements.indexOf(node) >= 0,\n      guard: isGuard(node)\n    };\n  });\n};\n\nvar getFocusMerge = function getFocusMerge(topNode, lastNode) {\n  var activeElement = document && document.activeElement;\n  var entries = getAllAffectedNodes(topNode).filter(notAGuard);\n\n  var commonParent = getTopCommonParent(activeElement || topNode, topNode, entries);\n\n  var innerElements = getTabbableNodes(entries).filter(function (_ref4) {\n    var node = _ref4.node;\n    return notAGuard(node);\n  });\n\n  if (!innerElements[0]) {\n    innerElements = getAllTabbableNodes(entries).filter(function (_ref5) {\n      var node = _ref5.node;\n      return notAGuard(node);\n    });\n    if (!innerElements[0]) {\n      return undefined;\n    }\n  }\n\n  var outerNodes = getTabbableNodes([commonParent]).map(function (_ref6) {\n    var node = _ref6.node;\n    return node;\n  });\n  var orderedInnerElements = reorderNodes(outerNodes, innerElements);\n  var innerNodes = orderedInnerElements.map(function (_ref7) {\n    var node = _ref7.node;\n    return node;\n  });\n\n  var newId = newFocus(innerNodes, outerNodes, activeElement, lastNode, innerNodes.filter(findAutoFocused(allParentAutofocusables(entries))));\n\n  if (newId === undefined) {\n    return newId;\n  }\n  return orderedInnerElements[newId];\n};\n\nexport default getFocusMerge;"]},"metadata":{},"sourceType":"module"}